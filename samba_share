#!/bin/bash

if [ "$EUID" == 0 ]; then
    source .lib_file

    printf "Do you want to\n1 - make a new folder to share\n2 - share an existing folder\n"
    NewFolder=$(Choice_cycle)

    
    ShareName=$(Input_cycle "Share name" "the share name")
    FolderPath=$(Input_cycle "Folder path" "the full path of the share folder")
    
    DomainName=$(Input_cycle "NetBIOS domain name" "NetBios domain name (In example.com -> EXAMPLE)")

    if [ "${NewFolder}" == 1 ]; then
	#mkdir -p ${FolderPath}
	printf "Newfolder is 1"
    fi

    

    printf "\n[${ShareName}]\n	path = ${FolderPath}\n	 inherit acls = yes" >> /etc/samba/share/${ShareName}
    printf "\ninclude /etc/samba/share/${ShareName}" >> /etc/samba/smb.conf
    smbcontrol all reload-config

    setfacl -m group::--- ${FolderPath}
    setfacl -m default:group::--- ${FolderPath}

    setfacl -m group:"${DomainName}\Domain Admins":rwx ${FolderPath}
    setfacl -m other::--- ${FolderPath}

else
    echo "Script must be run as root"
fi

exit 0
